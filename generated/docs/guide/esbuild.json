{
  "id": "guide/esbuild",
  "title": "Getting started with the Angular CLI's new build system",
  "contents": "\n\n\n\n\n<div class=\"content\">\n  <h1 id=\"getting-started-with-the-angular-clis-new-build-system\">Getting started with the Angular CLI's new build system<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#getting-started-with-the-angular-clis-new-build-system\"><i class=\"material-icons\">link</i></a></h1>\n<p>In v17 and higher, the new build system provides an improved way to build Angular applications. This new build system includes:</p>\n<ul>\n<li>A modern output format using ESM, with dynamic import expressions to support lazy module loading.</li>\n<li>Faster build-time performance for both initial builds and incremental rebuilds.</li>\n<li>Newer JavaScript ecosystem tools such as <a href=\"https://esbuild.github.io/\">esbuild</a> and <a href=\"https://vitejs.dev/\">Vite</a>.</li>\n<li>Integrated SSR and prerendering capabilites</li>\n</ul>\n<p>This new build system is stable and fully supported for use with Angular applications.\nYou can migrate to the new build system with applications that use the <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> builder.\nIf using a custom builder, please refer to the documentation for that builder on possible migration options.</p>\n<div class=\"alert is-important\">\n<p>The existing Webpack-based build system is still considered stable and fully supported.\nApplications can continue to use the <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> builder and will not be automatically migrated when updating.</p>\n</div>\n<h2 id=\"for-new-applications\">For new applications<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#for-new-applications\"><i class=\"material-icons\">link</i></a></h2>\n<p>New applications will use this new build system by default via the <code>application</code> builder.</p>\n<h2 id=\"for-existing-applications\">For existing applications<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#for-existing-applications\"><i class=\"material-icons\">link</i></a></h2>\n<p>For existing projects, you can opt-in to use the new builder on a per-application basis with two different options.\nBoth options are considered stable and fully supported by the Angular team.\nThe choice of which option to use is a factor of how many changes you will need to make to migrate and what new features you would like to use in the project.</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Builder</th>\n<th align=\"left\">Configuration Changes</th>\n<th align=\"left\">Code Changes</th>\n<th align=\"left\">Integrated SSR</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\"><code>application</code></td>\n<td align=\"left\">Multiple option changes required. If using SSR, additional targets will need to be updated.</td>\n<td align=\"left\">Yes, if using SSR</td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\"><code>browser-esbuild</code></td>\n<td align=\"left\">builder name only</td>\n<td align=\"left\">No*</td>\n<td align=\"left\">No</td>\n</tr>\n</tbody>\n</table>\n<p>The <code>application</code> builder is generally preferred as it improves server-side rendered (SSR) builds, and makes it easier for client-side rendered projects to adopt SSR in the future.\nHowever it requires a little more migration effort, particularly for existing SSR applications.\nIf the <code>application</code> builder is difficult for your project to adopt, <code>browser-esbuild</code> can be an easier solution which gives most of the build performance benefits with fewer breaking changes.</p>\n<h3 id=\"using-the-browser-esbuild-builder\">Using the <code>browser-esbuild</code> builder<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#using-the-browser-esbuild-builder\"><i class=\"material-icons\">link</i></a></h3>\n<p>A builder named <code>browser-esbuild</code> is available within the <code>@angular-devkit/build-angular</code> package that is present in an Angular CLI generated application. The builder is a drop-in replacement for the existing <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> builder that provides the preexisting browser application build system.</p>\n<p>The compatiblity option was implemented to minimize the amount of changes necessary to initially migrate your applications.\nThis is provided via an alternate builder (<code>browser-esbuild</code>).\nYou can update the <code>build</code> target for any application target to migrate to the new build system.</p>\n<p>The following is what you would typically find in <code>angular.json</code> for an application:</p>\n<code-example language=\"json\" hidecopy=\"true\">\n...\n\"architect\": {\n  \"build\": {\n    \"builder\": \"@angular-devkit/build-angular:browser\",\n...\n</code-example>\n<p>Changing the <code>builder</code> field is the only change you will need to make.</p>\n<code-example language=\"json\" hidecopy=\"true\">\n...\n\"architect\": {\n  \"build\": {\n    \"builder\": \"@angular-devkit/build-angular:browser-esbuild\",\n...\n</code-example>\n<h3 id=\"using-the-application-builder\">Using the <code>application</code> builder<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#using-the-application-builder\"><i class=\"material-icons\">link</i></a></h3>\n<p>A builder named <code>application</code> is also available within the <code>@angular-devkit/build-angular</code> package that is present in an Angular CLI generated application.\nThis builder is the default for all new applications created via <code>ng new</code>.</p>\n<p>The following is what you would typically find in <code>angular.json</code> for an application:</p>\n<code-example language=\"json\" hidecopy=\"true\">\n...\n\"architect\": {\n  \"build\": {\n    \"builder\": \"@angular-devkit/build-angular:browser\",\n...\n</code-example>\n<p>Changing the <code>builder</code> field is the first change you will need to make.</p>\n<code-example language=\"json\" hidecopy=\"true\">\n...\n\"architect\": {\n  \"build\": {\n    \"builder\": \"@angular-devkit/build-angular:application\",\n...\n</code-example>\n<p>Once the builder name has been changed, options within the <code>build</code> target will need to be updated.\nThe following table lists all the <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> builder options that will need to be adjusted or removed.</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"><code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> Option</th>\n<th align=\"left\">Action</th>\n<th align=\"left\">Notes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\"><code>main</code></td>\n<td align=\"left\">rename option to <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>polyfills</code></td>\n<td align=\"left\">convert value to an array</td>\n<td align=\"left\">may already have been migrated</td>\n</tr>\n<tr>\n<td align=\"left\"><code>buildOptimizer</code></td>\n<td align=\"left\">remove option</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>resourcesOutputPath</code></td>\n<td align=\"left\">move option to <code>outputPath.media</code></td>\n<td align=\"left\">defaults to <code>media</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>vendorChunk</code></td>\n<td align=\"left\">remove option</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>commonChunk</code></td>\n<td align=\"left\">remove option</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>deployUrl</code></td>\n<td align=\"left\">remove option</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>ngswConfigPath</code></td>\n<td align=\"left\">move value to <code>serviceWorker</code> and remove option</td>\n<td align=\"left\"><code>serviceWorker</code> is now either <code>false</code> or a configuration path</td>\n</tr>\n</tbody>\n</table>\n<p>If the application is not using SSR currently, this should be the final step to allow <code>ng build</code> to function.\nAfter executing <code>ng build</code> for the first time, there may be new warnings or errors based on behavioral differences or application usage of Webpack-specific features.\nMany of the warnings will provide suggestions on how to remedy that problem.\nIf it appears that a warning is incorrect or the solution is not apparent, please open an issue on <a href=\"https://github.com/angular/angular-cli/issues\">GitHub</a>.\nAlso, the later sections of this guide provide additional information on several specific cases as well as current known issues.</p>\n<p>For applications new to SSR, the <a href=\"/guide/ssr\">Angular SSR Guide</a> provides additional information regarding the setup process for adding SSR to an application.</p>\n<p>For applications that are already using SSR, additional adjustments will be needed to update the application server to support the new integrated SSR capabilities.\nThe <code>application</code> builder now provides the integrated functionality for all of the following preexisting builders:</p>\n<ul>\n<li><code>app-shell</code></li>\n<li><code>prerender</code></li>\n<li><code>server</code></li>\n<li><code>ssr-dev-server</code></li>\n</ul>\n<p>The <code>ng update</code> process will automatically remove usages of the <code>@nguniversal</code> scope packages where some of these builders were previously located.\nThe new <code>@angular/ssr</code> package will also be automatically added and used with configuration and code being adjusted during the update.\nThe <code>@angular/ssr</code> package supports the <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> builder as well as the <code>application</code> builder.\nTo convert from the separate SSR builders to the integrated capabilities of the <code>application</code> builder, run the experimental <code>use-application-builder</code> migration.</p>\n<code-example language=\"shell\">\n\nng update @angular/cli --name use-application-builder\n\n</code-example>\n<p>The migration does the following:</p>\n<ul>\n<li>Converts existing <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> or <code>browser-esbuild</code> target to <code>application</code></li>\n<li>Removes any previous SSR builders (because <code>application</code> does that now).</li>\n<li>Updates configuration accordingly.</li>\n<li>Merges <code>tsconfig.server.json</code> with <code>tsconfig.app.json</code> and adds the TypeScript option <code>\"esModuleInterop\": true</code> to ensure <code>express</code> imports are <a href=\"guide/esbuild#esm-default-imports-vs-namespace-imports\">ESM compliant</a>.</li>\n<li>Updates application server code to use new bootstrapping and output directory structure.</li>\n</ul>\n<div class=\"alert is-important\">\n<p>Remember to remove any CommonJS assumptions in the application server code such as <code>require</code>, <code>__filename</code>, <code>__dirname</code>, or other constructs from the <a href=\"https://nodejs.org/api/modules.html#the-module-scope\">CommonJS module scope</a>. All application code should be ESM compatible. This does not apply to third-party dependencies.</p>\n</div>\n<h2 id=\"executing-a-build\">Executing a build<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#executing-a-build\"><i class=\"material-icons\">link</i></a></h2>\n<p>Once you have updated the application configuration, builds can be performed using the <code>ng build</code> as was previously done.\nDepending on the choice of builder migration, some of the command line options may be different.\nIf the build command is contained in any <code>npm</code> or other scripts, ensure they are reviewed and updated.\nFor applications that have migrated to the <code>application</code> builder and that use SSR and/or prererending, you also may be able to remove extra <code>ng run</code> commands from scripts now that <code>ng build</code> has integrated SSR support.</p>\n<code-example language=\"shell\">\n\nng build\n\n</code-example>\n<h2 id=\"starting-the-development-server\">Starting the development server<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#starting-the-development-server\"><i class=\"material-icons\">link</i></a></h2>\n<p>The development server will automatically detect the new build system and use it to build the application.\nTo start the development server no changes are necessary to the <code>dev-server</code> builder configuration or command line.</p>\n<code-example language=\"shell\">\n\nng serve\n\n</code-example>\n<p>You can continue to use the <a href=\"/cli/serve\">command line options</a> you have used in the past with the development server.</p>\n<div class=\"alert is-important\">\n<p>JavaScript-based Hot Module Replacement (HMR) is currently not supported.\nHowever, global stylesheet (<code>styles</code> build option) HMR is available and enabled by default.\nAngular focused HMR capabilities are currently planned and will be introduced in a future version.</p>\n</div>\n<h2 id=\"unimplemented-options-and-behavior\">Unimplemented options and behavior<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#unimplemented-options-and-behavior\"><i class=\"material-icons\">link</i></a></h2>\n<p>Several build options are not yet implemented but will be added in the future as the build system moves towards a stable status. If your application uses these options, you can still try out the build system without removing them. Warnings will be issued for any unimplemented options but they will otherwise be ignored. However, if your application relies on any of these options to function, you may want to wait to try.</p>\n<ul>\n<li><a href=\"https://github.com/angular/angular-cli/issues/25102\">WASM imports</a> -- WASM can still be loaded manually via <a href=\"https://developer.mozilla.org/en-US/docs/WebAssembly/Loading_and_running\">standard web APIs</a>.</li>\n</ul>\n<p>Building libraries with the new build system via <code>ng-packagr</code> is also not yet possible but library build support will be available in a future release.</p>\n<h2 id=\"esm-default-imports-vs-namespace-imports\">ESM default imports vs. namespace imports<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#esm-default-imports-vs-namespace-imports\"><i class=\"material-icons\">link</i></a></h2>\n<p>TypeScript by default allows default exports to be imported as namespace imports and then used in call expressions. This is unfortunately a divergence from the ECMAScript specification. The underlying bundler (<code>esbuild</code>) within the new build system expects ESM code that conforms to the specification. The build system will now generate a warning if your application uses an incorrect type of import of a package. However, to allow TypeScript to accept the correct usage, a TypeScript option must be enabled within the application's <code>tsconfig</code> file. When enabled, the <a href=\"https://www.typescriptlang.org/tsconfig#esModuleInterop\"><code>esModuleInterop</code></a> option provides better alignment with the ECMAScript specification and is also recommended by the TypeScript team. Once enabled, you can update package imports where applicable to an ECMAScript conformant form.</p>\n<p>Using the <a href=\"https://npmjs.com/package/moment\"><code>moment</code></a> package as an example, the following application code will cause runtime errors:</p>\n<code-example language=\"ts\">\nimport * as moment from 'moment';\n\nconsole.log(moment().format());\n</code-example>\n<p>The build will generate a warning to notify you that there is a potential problem. The warning will be similar to:</p>\n<code-example format=\"shell\" language=\"shell\" hidecopy=\"true\">\n▲ [WARNING] Calling \"moment\" will crash at run-time because it's an import namespace object, not a function [call-import-namespace]\n\n    src/main.ts:2:12:\n      2 │ console.log(moment().format());\n        ╵             ~~~~~~\n\nConsider changing \"moment\" to a default import instead:\n\n    src/main.ts:1:7:\n      1 │ import * as moment from 'moment';\n        │        ~~~~~~~~~~~\n        ╵        moment\n\n</code-example>\n<p>However, you can avoid the runtime errors and the warning by enabling the <code>esModuleInterop</code> TypeScript option for the application and changing the import to the following:</p>\n<code-example language=\"ts\">\nimport moment from 'moment';\n\nconsole.log(moment().format());\n</code-example>\n<h2 id=\"vite-as-a-development-server\">Vite as a development server<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#vite-as-a-development-server\"><i class=\"material-icons\">link</i></a></h2>\n<p>The usage of Vite in the Angular CLI is currently only within a <em>development server capacity only</em>. Even without using the underlying Vite build system, Vite provides a full-featured development server with client side support that has been bundled into a low dependency npm package. This makes it an ideal candidate to provide comprehensive development server functionality. The current development server process uses the new build system to generate a development build of the application in memory and passes the results to Vite to serve the application. The usage of Vite, much like the Webpack-based development server, is encapsulated within the Angular CLI <code>dev-server</code> builder and currently cannot be directly configured.</p>\n<h2 id=\"known-issues\">Known Issues<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#known-issues\"><i class=\"material-icons\">link</i></a></h2>\n<p>There are currently several known issues that you may encounter when trying the new build system. This list will be updated to stay current. If any of these issues are currently blocking you from trying out the new build system, please check back in the future as it may have been solved.</p>\n<h3 id=\"type-checking-of-web-worker-code-and-processing-of-nested-web-workers\">Type-checking of Web Worker code and processing of nested Web Workers<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#type-checking-of-web-worker-code-and-processing-of-nested-web-workers\"><i class=\"material-icons\">link</i></a></h3>\n<p>Web Workers can be used within application code using the same syntax (<code>new Worker(new URL('&#x3C;workerfile>', import.meta.url))</code>) that is supported with the <code><a href=\"api/animations/browser\" class=\"code-anchor\">browser</a></code> builder.\nHowever, the code within the Worker will not currently be type-checked by the TypeScript compiler. TypeScript code is supported just not type-checked.\nAdditionally, any nested workers will not be processed by the build system. A nested worker is a Worker instantiation within another Worker file.</p>\n<h3 id=\"order-dependent-side-effectful-imports-in-lazy-modules\">Order-dependent side-effectful imports in lazy modules<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#order-dependent-side-effectful-imports-in-lazy-modules\"><i class=\"material-icons\">link</i></a></h3>\n<p>Import statements that are dependent on a specific ordering and are also used in multiple lazy modules can cause top-level statements to be executed out of order.\nThis is not common as it depends on the usage of side-effectful modules and does not apply to the <code>polyfills</code> option.\nThis is caused by a <a href=\"https://github.com/evanw/esbuild/issues/399\">defect</a> in the underlying bundler but will be addressed in a future update.</p>\n<div class=\"alert is-important\">\n<p>Avoiding the use of modules with non-local side effects (outside of polyfills) is recommended whenever possible regardless of the build system being used and avoids this particular issue. Modules with non-local side effects can have a negative effect on both application size and runtime performance as well.</p>\n</div>\n<h2 id=\"bug-reports\">Bug reports<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/esbuild#bug-reports\"><i class=\"material-icons\">link</i></a></h2>\n<p>Report issues and feature requests on <a href=\"https://github.com/angular/angular-cli/issues\">GitHub</a>.</p>\n<p>Please provide a minimal reproduction where possible to aid the team in addressing issues.</p>\n\n  \n</div>\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - /cli/serve\n - /guide/ssr\n - api/animations/browser\n - guide/esbuild#bug-reports\n - guide/esbuild#esm-default-imports-vs-namespace-imports\n - guide/esbuild#executing-a-build\n - guide/esbuild#for-existing-applications\n - guide/esbuild#for-new-applications\n - guide/esbuild#getting-started-with-the-angular-clis-new-build-system\n - guide/esbuild#known-issues\n - guide/esbuild#order-dependent-side-effectful-imports-in-lazy-modules\n - guide/esbuild#starting-the-development-server\n - guide/esbuild#type-checking-of-web-worker-code-and-processing-of-nested-web-workers\n - guide/esbuild#unimplemented-options-and-behavior\n - guide/esbuild#using-the-application-builder\n - guide/esbuild#using-the-browser-esbuild-builder\n - guide/esbuild#vite-as-a-development-server\n - https://developer.mozilla.org/en-US/docs/WebAssembly/Loading_and_running\n - https://esbuild.github.io/\n - https://github.com/angular/angular-cli/issues\n - https://github.com/angular/angular-cli/issues/25102\n - https://github.com/evanw/esbuild/issues/399\n - https://nodejs.org/api/modules.html#the-module-scope\n - https://npmjs.com/package/moment\n - https://vitejs.dev/\n - https://www.typescriptlang.org/tsconfig#esModuleInterop\n-->"
}